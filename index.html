<body>
  <h1>Generador de equipos para regatas</h1>
  <form id="myForm">
    <p>
      <label for="seatsPerBoat"">Capacidad de la embarcaci√≥n:</label>
      <input type="number" id="seatsPerBoat" value="8" style="max-width: 40px" /> personas
    </p>
     <p>
      <label for="minusPoints"">Diferencial entre hombres y mujeres:</label>
      <select id="minusPoints" style="min-width: 40px">
        <option value="1">1</option>
        <option value="2" selected="selected">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select>
      punto(s)
    </p>
    <p>
      <a target="_blank" href="https://docs.google.com/spreadsheets/d/1nCB2c5Boj2bOwyamWl4JFW-SR0KCKt2_zlUhJH_iod0/edit?usp=sharing">Copiar plantilla de participantes, editarla y descargarla en CSV</a>
    </p>
    <p>
      <label for="csvFile"">Cargar lista de participantes (CSV):</label>
      <input type="file" id="csvFile" accept=".csv" />
    </p>
    <p>
      <input type="submit" value="Generar equipos" />
    </p>
  </form>
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <script>
    const myForm = document.getElementById("myForm");
    const csvFile = document.getElementById("csvFile");
    const seatsPerBoat = document.getElementById("seatsPerBoat");

    /**
     * Implementation of https://en.wikipedia.org/wiki/Greedy_number_partitioning
     * Copied from https://github.com/dvopalecky/greedy-number-partitioning
     * Sorts the numbers in descending order
     * Then iteratively add the next-largest number to a set in which the current sum is smallest.
     * @param {number[]} array
     * @param {number} numberOfSubsets
     * @returns - Array of arrays of numbers
     */
    function greedyPartitioning (array, numberOfSubsets) {
      const sorted = array.sort((a, b) => b - a); // sort descending

      const out = [...Array(numberOfSubsets)].map(x => {
        return {
          sum: 0,
          elements: [],
        };
      });

      for (const elem of sorted) {
        const chosenSubset = out.sort((a, b) => a.sum - b.sum)[0];
        chosenSubset.elements.push(elem);
        chosenSubset.sum += elem;
      }

      return out.map(subset => subset.elements);
    }

    function generateGroups(data) {
      const totalParticipants = data.length;
      const totalGroups = totalParticipants / seatsPerBoat;
      
      if (totalParticipants < seatsPerBoat * 2) {
        alert("No hay suficientes participantes para llenar dos embarcaciones");
      }

      const men = data.filter((item) => item.sexo === 'hombre');
      const women = data.filter((item) => item.sexo === 'mujer');


      console.log(menCompetition, menLeisure, womenCompetition, womenLeisure);
      // data.map((boat) => )
    }

    myForm.addEventListener("submit", function (e) {
      e.preventDefault();
      const input = csvFile.files[0];
      const reader = new FileReader();

      reader.onload = function (e) {
        const text = e.target.result;
        const data = d3.csvParse(text);
        const parsedData = JSON.stringify(data);
        document.write(parsedData);
        generateGroups(data);
      };

      reader.readAsText(input);
    });
  </script>
</body>